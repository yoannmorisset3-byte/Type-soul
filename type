local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer

local boardName = "MissionBoard"
local AutoFarm = false

-- GUI
local sg = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
local f = Instance.new("Frame", sg)
f.Size, f.Position = UDim2.new(0,300,0,140), UDim2.new(0,10,0.4,0)
f.BackgroundColor3 = Color3.fromRGB(30,30,30)
f.Active, f.Draggable = true, true

local title = Instance.new("TextLabel", f)
title.Size, title.BackgroundTransparency = UDim2.new(1,0,0,30) = UDim2.new(1,0,0,30)
title.Text = "Type Soul AutoFarm"
title.TextScaled, title.TextColor3 = true, Color3.new(1,1,1)

local function btn(text, y, cb)
    local b = Instance.new("TextButton", f)
    b.Size, b.Position = UDim2.new(0.9,0,0,30), UDim2.new(0.05,0,0,y)
    b.Text, b.Font, b.TextScaled = text, Enum.Font.GothamBold, true
    b.BackgroundColor3, b.TextColor3 = Color3.fromRGB(50,50,50), Color3.new(1,1,1)
    b.MouseButton1Click:Connect(cb)
    return b
end

btn("Start AutoFarm", 40, function()
    AutoFarm = not AutoFarm
    btn.Text = AutoFarm and "Stop AutoFarm" or "Start AutoFarm"
    if AutoFarm then task.spawn(function()
        while AutoFarm do
            -- üìç T√©l√©portation devant le mission board
            local board = workspace:FindFirstChild(boardName)
            if board and board.PrimaryPart then
                local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if root then
                    root.CFrame = board.PrimaryPart.CFrame * CFrame.new(0,0,3)
                    task.wait(0.3)
                end
            else task.wait(2); continue end

            -- üìÑ Acceptation automatique de la qu√™te
            for _,v in ipairs(board:GetChildren()) do
                if v:IsA("ClickDetector") then
                    fireclickdetector(v); task.wait(0.5); break
                end
            end
            local pr = board:FindFirstChildOfClass("ProximityPrompt")
            if pr and pr.Enabled then
                pr:InputHoldBegin(); task.wait(0.5); pr:InputHoldEnd()
            end
            task.wait(1)

            -- ü™ß R√©cup√©ration des ennemis, attaque et ex√©cution
            local enemies = {}
            for _,npc in ipairs(workspace:GetDescendants()) do
                if npc:IsA("Model") and npc:FindFirstChild("Enemy") and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
                    table.insert(enemies, npc)
                end
            end

            while #enemies > 0 do
                for _,e in ipairs(enemies) do
                    if e:FindFirstChild("HumanoidRootPart") then
                        LocalPlayer.Character.HumanoidRootPart.CFrame = e.HumanoidRootPart.CFrame + Vector3.new(0,5,0)
                        task.wait(0.2)
                        for i=1,2 do
                            VirtualInputManager:SendMouseButtonEvent(500,500,0,true,game,1)
                            task.wait(0.05)
                            VirtualInputManager:SendMouseButtonEvent(500,500,0,false,game,1)
                        end
                    end
                end
                task.wait(0.5)
                -- ex√©cute les ennemis morts
                for _,e in ipairs(enemies) do
                    if e.Humanoid.Health <= 0 then
                        LocalPlayer.Character:PivotTo(e:GetPivot())
                        task.wait(0.1)
                        VirtualInputManager:SendKeyEvent(true,Enum.KeyCode.B,false,game)
                        task.wait(0.05)
                        VirtualInputManager:SendKeyEvent(false,Enum.KeyCode.B,false,game)
                        task.wait(0.3)
                    end
                end
                -- refresh
                enemies = {}
                for _,npc in ipairs(workspace:GetDescendants()) do
                    if npc:IsA("Model") and npc:FindFirstChild("Enemy") and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
                        table.insert(enemies, npc)
                    end
                end
            end

            task.wait(1)
        end
    end) end
end)

btn("Stop All", 90, function()
    AutoFarm = false
end)
