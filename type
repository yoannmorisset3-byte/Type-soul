local Players = game:GetService("Players")
local player = Players.LocalPlayer

local autofarmEnabled = false
local guiOpen = false

local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "AutoFarmGUI"

-- Bouton image Ouvrir/Fermer (toujours visible)
local toggleMainBtn = Instance.new("ImageButton", screenGui)
toggleMainBtn.Size = UDim2.new(0, 60, 0, 60)
toggleMainBtn.Position = UDim2.new(0, 20, 0.7, 0)
toggleMainBtn.BackgroundTransparency = 1
toggleMainBtn.Image = "rbxassetid://0" -- placeholder, on va changer après

-- Charge ton image depuis fichier local (uploadé)
local imagePath = "/mnt/data/6de78e52-4a95-4bcc-8b74-cb89b330fda8.png"
-- Impossible d'utiliser chemin local directement dans Roblox, il faut la mettre en ligne sur Roblox ou sur un hébergeur et récupérer l'AssetId

-- Pour l'instant, tu dois uploader cette image sur Roblox et remplacer ici l'ID de l'image, par exemple :
toggleMainBtn.Image = "rbxassetid://TonAssetIdIci"

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 732, 0, 400)
frame.Position = UDim2.new(0, 20, 0.7, -400)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.BackgroundTransparency = 0.2
frame.Visible = false

local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0, 40, 0, 30)
closeBtn.Position = UDim2.new(1, -45, 0, 10)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 22

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, -60, 0, 50)
title.Position = UDim2.new(0, 10, 0, 10)
title.BackgroundTransparency = 1
title.Text = "AutoFarm Type Soul"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 36
title.TextXAlignment = Enum.TextXAlignment.Left

local statusLabel = Instance.new("TextLabel", frame)
statusLabel.Size = UDim2.new(1, -20, 0, 40)
statusLabel.Position = UDim2.new(0, 10, 0, 70)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: OFF"
statusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
statusLabel.Font = Enum.Font.SourceSans
statusLabel.TextSize = 28
statusLabel.TextXAlignment = Enum.TextXAlignment.Left

local toggleBtn = Instance.new("TextButton", frame)
toggleBtn.Size = UDim2.new(0.6, 0, 0, 60)
toggleBtn.Position = UDim2.new(0.2, 0, 0, 130)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
toggleBtn.Text = "Activer AutoFarm"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextSize = 28

local NORMAL_RANGE = 30
local RANGE = NORMAL_RANGE * 3

local function getNearestEnemy()
    local nearestEnemy = nil
    local nearestDistance = math.huge

    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return nil end

    for _, npc in pairs(workspace:FindFirstChild("Enemies") and workspace.Enemies:GetChildren() or {}) do
        if npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 and npc:FindFirstChild("HumanoidRootPart") then
            local dist = (npc.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if dist < nearestDistance and dist <= RANGE then
                nearestDistance = dist
                nearestEnemy = npc
            end
        end
    end

    return nearestEnemy
end

local autofarmThread

local function startAutoFarm()
    if autofarmThread then return end
    autofarmThread = task.spawn(function()
        while autofarmEnabled do
            local enemy = getNearestEnemy()
            if enemy and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = enemy.HumanoidRootPart.CFrame * CFrame.new(0, 0, 2)
                local tool = player.Character:FindFirstChildOfClass("Tool")
                if tool and tool:FindFirstChild("Handle") then
                    tool:Activate()
                end
            end
            task.wait(0.5)
        end
        autofarmThread = nil
    end)
end

local function stopAutoFarm()
    autofarmEnabled = false
end

toggleMainBtn.MouseButton1Click:Connect(function()
    guiOpen = not guiOpen
    frame.Visible = guiOpen
    if guiOpen then
        toggleMainBtn.ImageTransparency = 0.5
    else
        toggleMainBtn.ImageTransparency = 0
    end
end)

closeBtn.MouseButton1Click:Connect(function()
    guiOpen = false
    frame.Visible = false
    toggleMainBtn.ImageTransparency = 0
end)

toggleBtn.MouseButton1Click:Connect(function()
    autofarmEnabled = not autofarmEnabled
    if autofarmEnabled then
        statusLabel.Text = "Status: ON"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        toggleBtn.Text = "Désactiver AutoFarm"
        startAutoFarm()
    else
        statusLabel.Text = "Status: OFF"
        statusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        toggleBtn.Text = "Activer AutoFarm"
        stopAutoFarm()
    end
end)  SAUVGARDE SA

